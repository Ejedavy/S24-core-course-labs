# Kubernetes Secrets and Hashicorp Vault

## Kubernetes Secrets and Resource Management

```shell
kubectl create secret generic my-secret --from-literal=username='david' --from-literal=password='test'  
secret/my-secret created
davideje@Davids-MacBook-Pro ~ % kubectl get secrets 
NAME        TYPE     DATA   AGE
my-secret   Opaque   2      14s
davideje@Davids-MacBook-Pro ~ % kubectl describe secret my-secret
Name:         my-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  4 bytes
username:  5 bytes
```
```shell
echo $(kubectl get secret my-secret -o jsonpath='{.data}')
{"password":"dGVzdA==","username":"ZGF2aWQ="}
```
```shell
davideje@Davids-MacBook-Pro ~ % echo dGVzdA== | base64 --decode
test 
````
```shell
davideje@Davids-MacBook-Pro ~ % echo ZGF2aWQ= | base64 --decode
david  
```

### Managing Secrets with Helm 
```shell
gpg --gen-key   
gpg (GnuPG) 2.4.5; Copyright (C) 2024 g10 Code GmbH
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

gpg: directory '/Users/davideje/.gnupg' created
Note: Use "gpg --full-generate-key" for a full featured key generation dialog.

GnuPG needs to construct a user ID to identify your key.

Real name: David
Email address: ejeohejidavid@gmail.com
You selected this USER-ID:
    "David <ejeohejidavid@gmail.com>"

Change (N)ame, (E)mail, or (O)kay/(Q)uit? O
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
gpg: /Users/davideje/.gnupg/trustdb.gpg: trustdb created
gpg: directory '/Users/davideje/.gnupg/openpgp-revocs.d' created
gpg: revocation certificate stored as '/Users/davideje/.gnupg/openpgp-revocs.d/60907063A4573F5391B2E063D917505496927A72.rev'
public and secret key created and signed.

pub   ed25519 2024-04-16 [SC] [expires: 2027-04-16]
      60907063A4573F5391B2E063D917505496927A72
uid                      David <ejeohejidavid@gmail.com>
sub   cv25519 2024-04-16 [E] [expires: 2027-04-16]
```


```shell
davideje@Davids-MacBook-Pro k8s % sops -p 39A5D96291F027B8CE0B0F459565578429F8E7DB secrets.yaml
davideje@Davids-MacBook-Pro k8s % helm secrets view secrets.yaml                               
password: secret123
```

```shell
davideje@Davids-MacBook-Pro k8s % helm secrets install app-python ./helm-app-python/ -f ./secrets.yaml
NAME: app-python
LAST DEPLOYED: Tue Apr 16 23:21:56 2024
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w app-python-helm-app-python'
  export SERVICE_IP=$(kubectl get svc --namespace default app-python-helm-app-python --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8000
./secrets.yaml.dec
```

```shell
davideje@Davids-MacBook-Pro k8s % kubectl get po                                                      
NAME                                         READY   STATUS    RESTARTS   AGE
app-python-helm-app-python-8dc99df79-b4q7h   1/1     Running   0          8s
```

```shell
davideje@Davids-MacBook-Pro k8s % kubectl exec app-python-helm-app-python-8dc99df79-b4q7h -- printenv | grep MY_PASSWORD
MY_PASSWORD=secret123
```

## Vault Secret Management System

```shell
davideje@Davids-MacBook-Pro k8s % kubectl get po
NAME                                          READY   STATUS    RESTARTS   AGE
app-python-helm-app-python-858bb56885-df6xv   2/2     Running   0          5s
vault-0                                       1/1     Running   0          102s
vault-agent-injector-dbfc5cd77-kpfhf          1/1     Running   0          102s
```

[![telegram-cloud-photo-size-2-5258291373906451319-y.jpg](https://i.postimg.cc/FKvyhMBd/telegram-cloud-photo-size-2-5258291373906451319-y.jpg)](https://postimg.cc/Wd9FnHjT)


[![telegram-cloud-photo-size-2-5258291373906451322-y.jpg](https://i.postimg.cc/3wZgNtsL/telegram-cloud-photo-size-2-5258291373906451322-y.jpg)](https://postimg.cc/CZzZ6sLD)